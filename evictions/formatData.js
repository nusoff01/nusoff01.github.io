// universal functions

function yearStringFunc (year) {
    var date = new Date(Number(year), 0, 0, 0, 0, 0, 0)
    return date.toISOString();
}

//barchart

var rawBarchartData = [
    ["2507000","2016","Boston","16","64.65","1445","31","5826","2314","1.3","3.27"],
    ["2509000","2016","Brockton","13.9","45.96","1054","32.5","1103","423","2.69","7.02"],
    ["2523000","2016","Fall River","17.5","63.79","757","29.2","1506","569","2.23","5.89"],
    ["2523875","2016","Fitchburg","14","47.31","954","32.7","575","234","3.1","7.62"],
    ["2529405","2016","Haverhill","10.4","40.86","1110","32.3","558","296","2.93","5.53"],
    ["2530840","2016","Holyoke","24.7","59.37","795","32.1","581","156","1.7","6.32"],
    ["2534550","2016","Lawrence","22.1","71.60","1067","33.9","904","435","2.39","4.96"],
    ["2537000","2016","Lowell","17.9","57.84","1089","33.1","1184","542","2.42","5.28"],
    ["2545000","2016","New Bedford","19.3","59.00","802","29.9","1530","527","2.19","6.37"],
    ["2553960","2016","Pittsfield","12.9","38.40","817","32","462","159","1.97","5.71"],
    ["2567000","2016","Springfield","24.7","53.25","858","36.7","2575","618","2.06","8.58"],
    ["2582000","2016","Worcester","16.1","57.87","1015","32.3","2241","789","1.97","5.59"],
    ["2507000","2008","Boston","15","62.73","1161","30.5","3085","2573","1.55","1.86"],
    ["2509000","2008","Brockton","10.14","41.43","940","32.5","808","722","4.87","5.45"],
    ["2523000","2008","Fall River","17.15","63.06","649","27.7","814","754","3.04","3.28"],
    ["2523875","2008","Fitchburg","14.75","42.08","800","35.2","316","246","3.5","4.5"],
    ["2529405","2008","Haverhill","8.51","36.45","961","32.2","","","",""],
    ["2530840","2008","Holyoke","25.15","57.38","668","32.5","627","362","4.06","7.02"],
    ["2534550","2008","Lawrence","24.91","63.77","922","37","","","",""],
    ["2537000","2008","Lowell","15.2","49.8","895","29.5","666","595","2.81","3.14"],
    ["2545000","2008","New Bedford","18.86","54.73","717","30.6","892","811","3.64","4.01"],
    ["2553960","2008","Pittsfield","11.72","38.19","674","31.1","497","290","3.73","6.4"],
    ["2567000","2008","Springfield","23.26","48.44","714","34","2338","1414","4.96","8.19"],
    ["2582000","2008","Worcester","13.88","51.14","842","29.6","1730","1358","3.57","4.55"]
];

function createDataForMeasure (measure) {
    var cities = {
        "Boston": {"2008": {}, "2016": {}},
        "Brockton": {"2008": {}, "2016": {}},
        "Fall River": {"2008": {}, "2016": {}},
        "Fitchburg": {"2008": {}, "2016": {}},
        "Haverhill": {"2008": {}, "2016": {}},
        "Holyoke": {"2008": {}, "2016": {}},
        "Lawrence": {"2008": {}, "2016": {}},
        "Lowell": {"2008": {}, "2016": {}},
        "New Bedford": {"2008": {}, "2016": {}},
        "Pittsfield": {"2008": {}, "2016": {}},
        "Springfield": {"2008": {}, "2016": {}},
        "Worcester": {"2008": {}, "2016": {}}
    }

    rawBarchartData.forEach(function(dp) {
        var city = dp[2];
        var yearString = yearStringFunc("2000");

        measureMap = {
            "Poverty Rate": 3,
            "Percent Renter Occupied": 4,
            "Median Gross Rent": 5,
            "Rent Burden": 6,
            "eviction filings": 7,
            "evictions": 8,
            "eviction rate": 9,
            "eviction filing rate": 10
        }
        var measureIndex = measureMap[measure];
        var yearIndex = dp[1];  
        measureObject = {};
        measureObject[measure] = Number(dp[measureIndex]);

        cities[city][yearIndex][yearString] = measureObject;

    });
    var citiesList = Object.keys(cities).map(function(cityName) {
        var cityObject = {};
        cityObject[cityName] = cities[cityName];
        return cityObject;
    });

    return citiesList;
}

// linechart

var raw = [["2507000","2008","Boston","625304","2573","1.55","1.86"],
["2507000","2009","Boston","625304","1996","1.2","1.45"],
["2507000","2010","Boston","617594","2065","1.24","1.54"],
["2507000","2011","Boston","650281","2101","1.24","1.54"],
["2507000","2012","Boston","650281","2542","1.49","3.78"],
["2507000","2013","Boston","650281","2532","1.47","3.64"],
["2507000","2014","Boston","650281","1759","1.01","3.27"],
["2507000","2015","Boston","650281","2504","1.42","3.26"],
["2507000","2016","Boston","650281","2314","1.3","3.27"],
["2509000","2008","Brockton","93217","722","4.87","5.45"],
["2509000","2009","Brockton","93217","720","4.87","5.59"],
["2509000","2010","Brockton","93810","620","4.21","5.01"],
["2509000","2011","Brockton","94532","738","4.96","5.97"],
["2509000","2012","Brockton","94532","565","3.76","4.66"],
["2509000","2013","Brockton","94532","712","4.67","5.65"],
["2509000","2014","Brockton","94532","783","5.09","6.42"],
["2509000","2015","Brockton","94532","597","3.84","6.49"],
["2509000","2016","Brockton","94532","423","2.69","7.02"],
["2523000","2008","Fall River","90853","754","3.04","3.28"],
["2523000","2009","Fall River","90853","755","3.05","3.28"],
["2523000","2010","Fall River","88857","801","3.24","3.56"],
["2523000","2011","Fall River","88727","995","4","4.4"],
["2523000","2012","Fall River","88727","783","3.13","3.54"],
["2523000","2013","Fall River","88727","910","3.62","3.94"],
["2523000","2014","Fall River","88727","1139","4.51","5.12"],
["2523000","2015","Fall River","88727","868","3.41","5.34"],
["2523000","2016","Fall River","88727","569","2.23","5.89"],
["2523875","2008","Fitchburg","41007","246","3.5","4.5"],
["2523875","2009","Fitchburg","41007","222","3.17","3.48"],
["2523875","2010","Fitchburg","40318","304","4.36","4.99"],
["2523875","2011","Fitchburg","40462","392","5.54","6.43"],
["2523875","2012","Fitchburg","40462","371","5.18","6.59"],
["2523875","2013","Fitchburg","40462","324","4.46","7.22"],
["2523875","2014","Fitchburg","40462","314","4.27","7.12"],
["2523875","2015","Fitchburg","40462","235","3.15","7.65"],
["2523875","2016","Fitchburg","40462","234","3.1","7.62"],
["2529405","2008","Haverhill","60681","","",""],
["2529405","2009","Haverhill","60681","","",""],
["2529405","2010","Haverhill","60879","270","2.91","3.53"],
["2529405","2011","Haverhill","62079","299","3.18","3.78"],
["2529405","2012","Haverhill","62079","375","3.93","6.26"],
["2529405","2013","Haverhill","62079","310","3.2","6.66"],
["2529405","2014","Haverhill","62079","308","3.14","6.62"],
["2529405","2015","Haverhill","62079","316","3.17","5.97"],
["2529405","2016","Haverhill","62079","296","2.93","5.53"],
["2530840","2008","Holyoke","40530","362","4.06","7.02"],
["2530840","2009","Holyoke","40530","389","4.35","7.76"],
["2530840","2010","Holyoke","39880","387","4.32","8.59"],
["2530840","2011","Holyoke","40342","425","4.72","9.09"],
["2530840","2012","Holyoke","40342","342","3.78","10.03"],
["2530840","2013","Holyoke","40342","234","2.57","8.19"],
["2530840","2014","Holyoke","40342","257","2.82","7.51"],
["2530840","2015","Holyoke","40342","239","2.61","7.3"],
["2530840","2016","Holyoke","40342","156","1.7","6.32"],
["2534550","2008","Lawrence","70273","","",""],
["2534550","2009","Lawrence","70273","","",""],
["2534550","2010","Lawrence","76377","402","2.32","2.54"],
["2534550","2011","Lawrence","78804","488","2.79","3.18"],
["2534550","2012","Lawrence","78804","518","2.94","4.98"],
["2534550","2013","Lawrence","78804","427","2.4","5.74"],
["2534550","2014","Lawrence","78804","367","2.05","5.57"],
["2534550","2015","Lawrence","78804","416","2.3","5.64"],
["2534550","2016","Lawrence","78804","435","2.39","4.96"],
["2537000","2008","Lowell","103077","595","2.81","3.14"],
["2537000","2009","Lowell","103077","621","2.94","3.3"],
["2537000","2010","Lowell","106519","651","3.09","3.43"],
["2537000","2011","Lowell","109349","457","2.14","2.41"],
["2537000","2012","Lowell","109349","686","3.18","5.33"],
["2537000","2013","Lowell","109349","582","2.67","5.99"],
["2537000","2014","Lowell","109349","587","2.67","6.29"],
["2537000","2015","Lowell","109349","596","2.68","5.48"],
["2537000","2016","Lowell","109349","542","2.42","5.28"],
["2545000","2008","New Bedford","91339","811","3.64","4.01"],
["2545000","2009","New Bedford","91339","881","3.94","4.28"],
["2545000","2010","New Bedford","95072","894","3.98","4.32"],
["2545000","2011","New Bedford","94909","1217","5.36","5.82"],
["2545000","2012","New Bedford","94909","824","3.59","3.9"],
["2545000","2013","New Bedford","94909","991","4.26","4.61"],
["2545000","2014","New Bedford","94909","1260","5.36","6.12"],
["2545000","2015","New Bedford","94909","877","3.69","5.46"],
["2545000","2016","New Bedford","94909","527","2.19","6.37"],
["2553960","2008","Pittsfield","42943","290","3.73","6.4"],
["2553960","2009","Pittsfield","42943","247","3.18","5.48"],
["2553960","2010","Pittsfield","44737","257","3.3","5.81"],
["2553960","2011","Pittsfield","43926","313","3.99","6.4"],
["2553960","2012","Pittsfield","43926","281","3.56","6.7"],
["2553960","2013","Pittsfield","43926","313","3.94","6.84"],
["2553960","2014","Pittsfield","43926","275","3.44","7.19"],
["2553960","2015","Pittsfield","43926","271","3.37","7.21"],
["2553960","2016","Pittsfield","43926","159","1.97","5.71"],
["2567000","2008","Springfield","153170","1414","4.96","8.19"],
["2567000","2009","Springfield","153170","1461","5.12","8.75"],
["2567000","2010","Springfield","153060","1496","5.25","9.01"],
["2567000","2011","Springfield","153947","1468","5.1","10"],
["2567000","2012","Springfield","153947","1072","3.69","9.6"],
["2567000","2013","Springfield","153947","905","3.09","9.12"],
["2567000","2014","Springfield","153947","899","3.05","10.03"],
["2567000","2015","Springfield","153947","833","2.8","9.76"],
["2567000","2016","Springfield","153947","618","2.06","8.58"],
["2582000","2008","Worcester","178397","1358","3.57","4.55"],
["2582000","2009","Worcester","178397","1217","3.2","3.69"],
["2582000","2010","Worcester","181045","1491","3.92","4.67"],
["2582000","2011","Worcester","183382","1608","4.18","4.99"],
["2582000","2012","Worcester","183382","1362","3.52","4.85"],
["2582000","2013","Worcester","183382","977","2.5","4.7"],
["2582000","2014","Worcester","183382","1233","3.13","5.8"],
["2582000","2015","Worcester","183382","807","2.03","6.04"],
["2582000","2016","Worcester","183382","789","1.97","5.59"]];


function createLinechartData () {
    var cities = {
        "Boston": {"": {}},
        "Brockton": {"": {}},
        "Fall River": {"": {}},
        "Fitchburg": {"": {}},
        "Haverhill": {"": {}},
        "Holyoke": {"": {}},
        "Lawrence": {"": {}},
        "Lowell": {"": {}},
        "New Bedford": {"": {}},
        "Pittsfield": {"": {}},
        "Springfield": {"": {}},
        "Worcester": {"": {}}
    }
    raw.forEach(function (rawDP) {
        var city = rawDP[2];
        var yearString = yearStringFunc(rawDP[1])
        var evictionRate = (rawDP[5] === "" || rawDP[5] === null) ? null : Number(rawDP[5]);
        cities[city][""][yearString] = {"evictionRate": evictionRate}
    });
    return Object.keys(cities).map(function (cityName){
        var cityObject = {};
        cityObject[cityName] = cities[cityName];
        return cityObject;
    })
}


