<!DOCTYPE html> 
<html>
    <head>
            <title>Basic Charts</title>
    </head>
    <body style="font-family: 'Segoe UI', sans-serif; padding: 20px;">
        <div id="chart1" style="width: 100%; height: 500px;"></div>
        <div style="font-size:20px; display:inline-flex; align-items:center;">
            Compare cities in 2008 and 2016 for: 
                <select id="measureSelect" style="font-size:20px;margin:8px;">
                        <option>poverty rate</option>
                        <option>median gross rent</option>
                        <option>median household income</option>
                        <option>% renter occupied</option>
                        <option>median property value</option>
                        <option>rent burden</option>
                        <option>eviction filings</option>
                        <option>evictions</option>
                        <option>eviction rate</option>
                        <option>eviction filing rate</option>
                </select>
        </div>
       
        <div id="chart2" style="width: 100%; height: 500px;"></div>
        
        <script>
            window.onload = function() {
var data = [
    {"": {
        "Boston": {
            "2008-01-02T00:00:00.00Z": {
                "eviction rate": 1.55
            },
            "2009-01-02T00:00:00.00Z": {
                "eviction rate": 1.2
            },
            "2010-01-02T00:00:00.00Z": {
                "eviction rate": 1.24
            },
            "2011-01-02T00:00:00.00Z": {
                "eviction rate": 1.24
            },
            "2012-01-02T00:00:00.00Z": {
                "eviction rate": 1.49
            },
            "2013-01-02T00:00:00.00Z": {
                "eviction rate": 1.47
            },
            "2014-01-02T00:00:00.00Z": {
                "eviction rate": 1.01
            },
            "2015-01-02T00:00:00.00Z": {
                "eviction rate": 1.42
            },
            "2016-01-02T00:00:00.00Z": {
                "eviction rate": 1.3
            }
        },
  "Brockton": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 4.87
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 4.87
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 4.21
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 4.96
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 3.76
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 4.67
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 5.09
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 3.84
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 2.69
      }
    
  },
  "Cambridge": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 0.59
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 0.2
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 0.07
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 0.24
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 1.01
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 0.92
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 0.88
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 0.99
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 1.06
      }
    
  },
  "Fall River": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 3.04
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 3.05
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 3.24
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 4
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 3.13
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 3.62
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 4.51
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 3.41
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 2.23
      
    }
  },
  "Lowell": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 2.81
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 2.94
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 3.09
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 2.14
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 3.18
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 2.67
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 2.67
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 2.68
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 2.42
      
    }
  },
  "Lynn": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 0
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 0
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 2.9
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 3.41
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 3.15
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 2.86
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 2.91
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 2.85
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 2.75
      }
    
  },
  "New Bedford": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 3.64
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 3.94
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 3.98
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 5.36
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 3.59
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 4.26
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 5.36
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 3.69
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 2.19
      }
    
  },
  "Quincy": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 1.54
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 1.12
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 1.31
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 1.53
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 1.48
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 1.36
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 1.4
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 1.59
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 1.47
      }
    }
  },
  "Springfield": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 4.96
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 5.12
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 5.25
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 5.1
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 3.69
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 3.09
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 3.05
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 2.8
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 2.06
      }
    
  },
  "Worcester": {
    
      "2008-01-02T00:00:00.00Z": {
        "eviction rate": 3.57
      },
      "2009-01-02T00:00:00.00Z": {
        "eviction rate": 3.2
      },
      "2010-01-02T00:00:00.00Z": {
        "eviction rate": 3.92
      },
      "2011-01-02T00:00:00.00Z": {
        "eviction rate": 4.18
      },
      "2012-01-02T00:00:00.00Z": {
        "eviction rate": 3.52
      },
      "2013-01-02T00:00:00.00Z": {
        "eviction rate": 2.5
      },
      "2014-01-02T00:00:00.00Z": {
        "eviction rate": 3.13
      },
      "2015-01-02T00:00:00.00Z": {
        "eviction rate": 2.03
      },
      "2016-01-02T00:00:00.00Z": {
        "eviction rate": 1.97
      }
  }
}
]






                // render the data in a chart
                var tsiClient = new TsiClient();
                var lineChart = new tsiClient.ux.LineChart(document.getElementById('chart1'));
                lineChart.render(data, {offset: 'UTC', yAxisState: "shared", tooltip: true, legend: "compact", theme: "light", singleLineXAxisLabel: true, hideChartControlPanel: true, canDownload: false});




                var yearStringFunc = (year) => {
                    var date = new Date(Number(year), 0, 0, 0, 0, 0, 0)
                    return date.toISOString();
                }
            var cities = {
                "Boston": {"2008": {}, "2016": {}},
                "Brockton": {"2008": {}, "2016": {}},
                "Cambridge": {"2008": {}, "2016": {}},
                "Fall River": {"2008": {}, "2016": {}},
                "Lowell": {"2008": {}, "2016": {}},
                "Lynn": {"2008": {}, "2016": {}},
                "New Bedford": {"2008": {}, "2016": {}},
                "Quincy": {"2008": {}, "2016": {}},
                "Springfield": {"2008": {}, "2016": {}},
                "Worcester": {"2008": {}, "2016": {}}
            }

            var raw = [["2507000", "2016", "Boston", "650281", "16.92", "178128", "65.68", "1320", "55777", "393600", "31.1", "5826", "2314", "1.3", "3.27", "0", "0", "0"],
                ["2509000", "2016", "Brockton", "94532", "15.8", "15707", "45.44", "1022", "47557", "221400", "34.3", "1103", "423", "2.69", "7.02", "1", "0", "0"],
                ["2511000", "2016", "Cambridge", "107916", "8.95", "31426", "62.94", "1686", "79416", "581700", "28.6", "504", "332", "1.06", "1.6", "0", "0", "0"],
                ["2523000", "2016", "Fall River", "88727", "19.44", "25561", "65.07", "729", "35213", "232500", "30.6", "1506", "569", "2.23", "5.89", "0", "0", "0"],
                ["2537000", "2016", "Lowell", "109349", "16", "22438", "56.84", "1005", "48002", "232200", "32.6", "1184", "542", "2.42", "5.28", "0", "0", "0"],
                ["2537490", "2016", "Lynn", "91626", "16.71", "18472", "54.97", "1016", "47429", "254600", "33.3", "1057", "508", "2.75", "5.72", "1", "0", "0"],
                ["2545000", "2016", "New Bedford", "94909", "19.5", "24031", "57.98", "771", "37574", "206900", "30.2", "1530", "527", "2.19", "6.37", "0", "0", "0"],
                ["2555745", "2016", "Quincy", "93177", "7.78", "22523", "52.69", "1250", "64155", "351800", "28.7", "465", "330", "1.47", "2.06", "0", "0", "0"],
                ["2567000", "2016", "Springfield", "153947", "25.81", "30020", "52.24", "823", "34728", "144700", "38.5", "2575", "618", "2.06", "8.58", "1", "0", "0"],
                ["2582000", "2016", "Worcester", "183382", "17.17", "40075", "56.98", "945", "45472", "205200", "31.9", "2241", "789", "1.97", "5.59", "0", "0", "0"],
                ["2507000", "2008", "Boston", "625304", "15", "165985", "62.73", "1161", "52433", "404500", "30.5", "3085", "2573", "1.55", "1.86", "1", "0", "0"],
                ["2509000", "2008", "Brockton", "93217", "10.14", "14830", "41.43", "940", "50197", "281900", "32.5", "808", "722", "4.87", "5.45", "1", "0", "0"],
                ["2511000", "2008", "Cambridge", "106255", "9.08", "28800", "62.48", "1415", "64420", "567200", "30.2", "231", "169", "0.59", "0.8", "1", "0", "0"],
                ["2523000", "2008", "Fall River", "90853", "17.15", "24819", "63.06", "649", "35814", "267000", "27.7", "814", "754", "3.04", "3.28", "0", "0", "0"],
                ["2537000", "2008", "Lowell", "103077", "15.2", "21183", "49.8", "895", "49816", "261200", "29.5", "666", "595", "2.81", "3.14", "1", "0", "0"],
                ["2537490", "2008", "Lynn", "87196", "15.13", "", "50.72", "906", "41933", "297500", "33.9", "", "", "", "", "0", "0", "0"],
                ["2545000", "2008", "New Bedford", "91339", "18.86", "22258", "54.73", "717", "36775", "248500", "30.6", "892", "811", "3.64", "4.01", "0", "0", "0"],
                ["2555745", "2008", "Quincy", "90120", "6.69", "20910", "48.74", "1114", "60067", "364700", "29.2", "454", "321", "1.54", "2.17", "1", "0", "0"],
                ["2567000", "2008", "Springfield", "153170", "23.26", "28535", "48.44", "714", "34113", "153000", "34", "2338", "1414", "4.96", "8.19", "1", "0", "0"],
                ["2582000", "2008", "Worcester", "178397", "13.88", "38056", "51.14", "842", "45944", "248300", "29.6", "1730", "1358", "3.57", "4.55", "1", "0", "0"]];


            function createDataForMeasure (measure) {
                var cities = {
                    "Boston": {"2008": {}, "2016": {}},
                    "Brockton": {"2008": {}, "2016": {}},
                    "Cambridge": {"2008": {}, "2016": {}},
                    "Fall River": {"2008": {}, "2016": {}},
                    "Lowell": {"2008": {}, "2016": {}},
                    "Lynn": {"2008": {}, "2016": {}},
                    "New Bedford": {"2008": {}, "2016": {}},
                    "Quincy": {"2008": {}, "2016": {}},
                    "Springfield": {"2008": {}, "2016": {}},
                    "Worcester": {"2008": {}, "2016": {}}
                }
                raw.forEach((dp) => {
                    var city = dp[2];
                    var yearString = yearStringFunc("2000");
                    measureMap = {
                        "poverty rate": 4,
                        "% renter occupied": 6,
                        "median gross rent": 7,
                        "median household income": 8,
                        "median property value": 9,
                        "rent burden": 10,
                        "eviction filings": 11,
                        "evictions": 12,
                        "eviction rate": 13,
                        "eviction filing rate": 14
                    }
                    var measureIndex = measureMap[measure];
                    var yearIndex = dp[1];  
                    measureObject = {};
                    measureObject[measure] = Number(dp[measureIndex]);

                    cities[city][yearIndex][yearString] = measureObject;

                });
                var citiesList = Object.keys(cities).map((cityName) => {
                    var cityObject = {};
                    cityObject[cityName] = cities[cityName];
                    return cityObject;
                });

                barChart.render(citiesList, {theme: 'light', tooltip: true, legend: 'hidden', offset: "Local", canDownload: false});
            }

            document.getElementById('measureSelect').onchange = function(){createDataForMeasure(this.value)};
                var barChart = new tsiClient.ux.BarChart(document.getElementById('chart2'));
                createDataForMeasure("poverty rate");
           };

        </script>
    </body>

    <!-- boilerplate headers are injected with head.js, grab them from the live example header, or include a link to head.js -->
    <script src="head.js"></script>
</html>